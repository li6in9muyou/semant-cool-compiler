#!/usr/bin/env bash

red() {
  xargs printf "\033[0;31m%s\033[0m\n"
}

green() {
  xargs printf "\033[0;32m%s\033[0m\n"
}

actual() {
  mylexer "$1" | myparser | ./semant 2>&1
}

expected() {
  lexer "$1" | parser | semant 2>&1
}

make lexer

for cl in "$@"
do
    input_cl="$cl"
    echo "INPUT: ${input_cl}"
    if [[ ! -f "$input_cl" ]]; then
        echo "FILE NOT FOUND" | red
        continue;
    fi
    if diff -u --color \
             --label actual <(actual "$input_cl") \
             --label expected <(expected "$input_cl"); then
      echo PASS | green
    else
      echo FAILED | red
    fi
done

